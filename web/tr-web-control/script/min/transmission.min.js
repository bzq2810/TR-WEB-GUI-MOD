/*! transmission-web-control 2017-09-29 */

var transmission={SessionId:"",isInitialized:!1,host:"",port:"9091",path:"/transmission/rpc",rpcpath:"../rpc",fullpath:"",on:{torrentCountChange:null,postError:null},username:"",password:"",_status:{stopped:0,checkwait:1,check:2,downloadwait:3,download:4,seedwait:5,seed:6,actively:101},_trackerStatus:{inactive:0,waiting:1,queued:2,active:3},options:{getFolders:!0,getTarckers:!0},headers:{},trackers:{},islocal:!1,downloadDirs:new Array,getSessionId:function(a,b){var c={type:"POST",url:this.fullpath,error:function(c,d,e){var f="";409===c.status&&(f=c.getResponseHeader("X-Transmission-Session-Id"))&&(a.isInitialized=!0,a.SessionId=f,a.headers["X-Transmission-Session-Id"]=f,b&&b())},headers:this.headers};jQuery.ajax(c)},init:function(a,b){jQuery.extend(this,a),this.username&&this.password&&(this.headers.Authorization="Basic "+(new Base64).encode(this.username+":"+this.password)),this.fullpath=this.rpcpath,this.getSessionId(this,b)},exec:function(a,b,c){if(!this.isInitialized)return!1;var d={method:"",arguments:{},tag:""};jQuery.extend(d,a);var e={type:"POST",url:this.fullpath,dataType:"json",data:JSON.stringify(d),success:function(a,d){b&&b(a,c)},error:function(a,b,c){var d="";409===a.status&&(d=a.getResponseHeader("X-Transmission-Session-Id"))?(transmission.SessionId=d,transmission.headers["X-Transmission-Session-Id"]=d,jQuery.ajax(e)):transmission.on.postError&&transmission.on.postError(a)},headers:this.headers};jQuery.ajax(e)},getStatus:function(a){this.exec({method:"session-stats"},function(b){"success"==b.result&&(a&&a(b.arguments),transmission.torrents.count==b.arguments.torrentCount&&transmission.torrents.activeTorrentCount==b.arguments.activeTorrentCount&&transmission.torrents.pausedTorrentCount==b.arguments.pausedTorrentCount||(transmission.torrents.count=b.arguments.torrentCount,transmission.torrents.activeTorrentCount=b.arguments.activeTorrentCount,transmission.torrents.pausedTorrentCount=b.arguments.pausedTorrentCount,transmission._onTorrentCountChange()))})},getSession:function(a){this.exec({method:"session-get"},function(b){"success"==b.result&&a&&a(b.arguments)})},addTorrentFromUrl:function(a,b,c,d){a.match(/^[0-9a-f]{40}$/i)&&(a="magnet:?xt=urn:btih:"+a);var e={method:"torrent-add",arguments:{filename:a,paused:!c}};b&&(e.arguments["download-dir"]=b),this.exec(e,function(a){switch(a.result){case"success":d&&(a.arguments["torrent-added"]?d(a.arguments["torrent-added"]):a.arguments["torrent-duplicate"]&&d({status:"duplicate",torrent:a.arguments["torrent-duplicate"]}));break;case"duplicate torrent":default:d&&d(a.result)}})},addTorrentFromFile:function(a,b,c,d,e){var f=new FileReader;f.onload=function(a){var f=a.target.result,g=f.indexOf("base64,");if(-1!=g){var h=f.substring(g+"base64,".length);transmission.exec({method:"torrent-add",arguments:{metainfo:h,"download-dir":b,paused:c}},function(a){switch(a.result){case"success":d&&d(a.arguments["torrent-added"],e);break;case"duplicate torrent":d&&d("duplicate")}})}},f.readAsDataURL(a)},_onTorrentCountChange:function(){this.torrents.loadSimpleInfo=!1,this.on.torrentCountChange&&this.on.torrentCountChange()},removeTorrent:function(a,b,c){this.exec({method:"torrent-remove",arguments:{ids:a,"delete-local-data":b}},function(a){c&&c(a.result)})},getFreeSpace:function(a,b){this.exec({method:"free-space",arguments:{path:a}},function(a){b&&b(a)})},updateBlocklist:function(a){this.exec({method:"blocklist-update"},function(b){a&&a(b.result)})},renameTorrent:function(a,b,c,d){var e=this.torrents.all[a];if(!e)return!1;this.exec({method:"torrent-rename-path",arguments:{ids:[a],path:b||e.name,name:c}},function(a){d&&d(a)})},closeSession:function(a){this.exec({method:"session-close"},function(b){a&&a(b)})}};